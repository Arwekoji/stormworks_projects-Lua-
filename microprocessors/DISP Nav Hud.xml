<?xml version="1.0" encoding="UTF-8"?>
<microprocessor name="DISP (Nav Hud)" width="3" length="4" id_counter="94" id_counter_node="26" sym0="54699" sym1="32769" sym2="7636" sym3="42325" sym4="9564" sym5="42325" sym6="7508" sym7="32769" sym8="32769" sym10="37541" sym11="11188" sym12="43693" sym13="10532" sym14="32769" sym15="54699">
	<nodes>
		<n id="11" component_id="35">
			<node label="Out (Seat HUD)" type="6" description="257x192, Only bright colors"/>
		</n>
		<n id="12" component_id="37">
			<node label="In (Seat Data)" mode="1" type="5" description="Only forward look">
				<position x="1"/>
			</node>
		</n>
		<n id="13" component_id="39">
			<node label="In (Nav Data)" mode="1" type="5" description="from GPS mc">
				<position x="2" z="1"/>
			</node>
		</n>
		<n id="14" component_id="41">
			<node label="In (Radar objects)" mode="1" type="5" description="raw data">
				<position x="1" z="1"/>
			</node>
		</n>
		<n id="15" component_id="43">
			<node label="In (Control HUD)" mode="1" type="5" description="1 - Nav, 2 - radar, 3 - locator switch">
				<position x="2"/>
			</node>
		</n>
		<n id="17" component_id="46">
			<node label="In (Locator)" mode="1" description="raw data">
				<position z="2"/>
			</node>
		</n>
		<n id="18" component_id="47">
			<node label="In (Radar Detector)" mode="1">
				<position z="1"/>
			</node>
		</n>
		<n id="22" component_id="64">
			<node label="In (Reverse Mod)" mode="1">
				<position z="3"/>
			</node>
		</n>
		<n id="23" component_id="67">
			<node label="In (Clutch)" mode="1" type="1">
				<position x="1" z="2"/>
			</node>
		</n>
		<n id="24" component_id="68">
			<node label="In (Height)" mode="1" type="1" description="from Altimeter">
				<position x="2" z="2"/>
			</node>
		</n>
		<n id="25" component_id="70">
			<node label="In (aka Throttle or vtilt)" mode="1" type="1" description="Customize name">
				<position x="1" z="3"/>
			</node>
		</n>
		<n id="26" component_id="73">
			<node label="In (aka Radiochannel or htilt)" mode="1" type="1" description="Customize name">
				<position x="2" z="3"/>
			</node>
		</n>
	</nodes>
	<group>
		<data>
			<inputs/>
			<outputs/>
		</data>
		<components>
			<c type="56">
				<object id="20" script='HUD_WIDTH = 257
HUD_HEIGHT = 192
HUD_CENTER_X = 126
HUD_CENTER_Y = 96
FOV_X = 74 
FOV_Y = 60 

blinker = 0
rdetect = 0

function to_degrees(from1to360)
	return from1to360*360
end

function atan2(y, x)
	if x &gt; 0 then
		return math.atan(y / x)
	elseif x &lt; 0 and y &gt;= 0 then
		return math.atan(y / x) + math.pi
	elseif x &lt; 0 and y &lt; 0 then
		return math.atan(y / x) - math.pi
	elseif x == 0 and y &gt; 0 then
		return math.pi / 2
	elseif x == 0 and y &lt; 0 then
		return -math.pi / 2
	else
		return 0
	end
end

function angleDelta(a, b)
	local d = (a - b) % 360
	if d &gt; 180 then d = d - 360 end
	return d
end

function onTick()
	distance	   = input.getNumber(1)
	relative_angle = input.getNumber(2)
	gps_x		  = input.getNumber(3)
	gps_y		  = input.getNumber(4)
	tgps_x		 = input.getNumber(5)
	tgps_y		 = input.getNumber(6)
	compass		= input.getNumber(7)
	look_x	 = to_degrees(input.getNumber(8))
	look_y	 = to_degrees(input.getNumber(9))
	clutch	 = input.getNumber(10)
	height	 = input.getNumber(11)
	num_middle = input.getNumber(12)
	num_down   = input.getNumber(13)
	loc_dist   = input.getNumber(14)
	
	nav_switch = input.getBool(1)
	rad_switch = input.getBool(2)
	loc_switch = input.getBool(3)
	rad_detect = input.getBool(4)
	reverse	= input.getBool(5)
	
	
	name_middle = property.getText("custom_name_middle")
	name_down   = property.getText("custom_name_down")
	
	
	view_angle = (compass + look_x) % 360
	
	blinker = blinker + 1
	if blinker &gt; 60 then
		blinker = -1*30
	end
	
	rdetect = math.max(0, rdetect-1)
	if rad_detect == true then
		rdetect = 600
	end
end




function drawCustomW(x, y)
	screen.drawLine(x,   y,   x,   y+4) 
	screen.drawLine(x+1, y+4, x+1, y+5)   
	screen.drawLine(x+2, y+3, x+2, y+4)   
	screen.drawLine(x+3, y+4, x+3, y+5)       
	screen.drawLine(x+4, y,   x+4, y+4) 
end

function drawCustomText(x, y, text)
	local cx = x
	for i = 1, #text do
		local char = text:sub(i, i)
		if char == "W" then
			drawCustomW(cx, y)
			cx = cx + 5 + 1 --   W + 
		else
			screen.drawText(cx, y, char)
			cx = cx + 4 + 1 --    + 
		end
	end
end

function getTextWidth(T)
	local w = 0
	for i = 1, #T do
		local c = T:sub(i, i)
		w = w + (c == "W" and 5 or 4)
		if i &lt; #T then
			w = w + 1
		end
	end
	return w
end

function drawCenteredCustomText(center_x, y, text)
	local total_width = getTextWidth(text)
	local start_x = math.floor(center_x - total_width / 2)
	drawCustomText(start_x, y, text)
end



function drawCompass()
	directions = {
{name="N", angle=0}, {name="|", angle=22.5}, {name="NE", angle=45},
{name="|", angle=67.5}, {name="E", angle=90}, {name="|", angle=112.5},
{name="SE", angle=135}, {name="|", angle=157.5}, {name="S", angle=180},
{name="|", angle=202.5}, {name="SW", angle=225}, {name="|", angle=247.5},
{name="W", angle=270}, {name="|", angle=292.5}, {name="NW", angle=315},
{name="|", angle=337.5}}
	panel_x, panel_y = 95, 0
	panel_w, panel_h = 61, 9 
	half_pw = 30

	screen.setColor(100, 100, 100)
	screen.drawRectF(panel_x-4,panel_y,panel_w+8,panel_h)
	screen.setColor(0, 10, 0)

	for _, dir in ipairs(directions) do
		local rel_angle = math.floor((dir.angle - view_angle + 540) % 360 - 180)
		if math.abs(rel_angle) &lt;= half_pw then     
			local x = HUD_CENTER_X + rel_angle - 3 
			if x &gt;= panel_x and x &lt;= panel_x + panel_w - 6 then
				local fade = math.abs(rel_angle) * 6
				local alpha = math.max(60, 255 - fade)
				screen.setColor(0, 50, 0, alpha)
				drawCenteredCustomText(math.floor(x)+3, 2, dir.name)
			end
		end
	end

    screen.setColor(0, 255, 0)
    screen.drawLine(HUD_CENTER_X, 0, HUD_CENTER_X, panel_h)
	
end

function drawGPS()
	screen.setColor(0, 255, 0)
	
	screen.drawText(0, 173, "H")
	screen.drawText(4, 173, ":")
	screen.drawText(8, 173, height &gt;= 0 and "+" or "-")
	screen.drawText(12, 173, math.abs(math.floor(height)))
	
	screen.drawText(0, 180, "X")
	screen.drawText(4, 180, ":")
	screen.drawText(8, 180, gps_x &gt;= 0 and "+" or "-")
	screen.drawText(12, 180, math.abs(math.floor(gps_x)))
	
	screen.drawText(0, 187, "Y")
	screen.drawText(4, 187, ":")
	screen.drawText(8, 187, gps_y &gt;= 0 and "+" or "-")
	screen.drawText(12, 187, math.abs(math.floor(gps_y)))
	
	screen.drawText(209, 173, "tD")
	screen.drawText(218, 173, ":")
	screen.drawText(222, 173, string.format("%.0fkm", distance))
	
	screen.drawText(209, 180, "tX")
	screen.drawText(218, 180, ":")
	screen.drawText(222, 180, tgps_x &gt;= 0 and "+" or "-")
	screen.drawText(226, 180, math.abs(math.floor(tgps_x)))
	
	screen.drawText(209, 187, "tY")
	screen.drawText(218, 187, ":")
	screen.drawText(222, 187, tgps_y &gt;= 0 and "+" or "-")
	screen.drawText(226, 187, math.abs(math.floor(tgps_y)))
end


function drawNavArrows()
	local relative_to_look = (relative_angle - look_x + 540) % 360 - 180
	screen.setColor(0, 0, 255, math.abs(relative_to_look))
	
	if blinker &gt; 0 then
	
		if relative_to_look &lt; -5 or relative_to_look &gt; 170 then
			screen.drawTriangleF(20, 90, 20, 110, 0, 100)
		end
		
		if relative_to_look &gt; 5 or relative_to_look &lt; -170 then
			screen.drawTriangleF(237, 90, 237, 110, 257, 100)
		end
		
	end
end


 

function drawTargetHUD(targetX, targetY, targetZ, R, G, B, A)
    local dx = targetX - gps_x
    local dy = targetY - gps_y
    local dz = targetZ - height
    screen.setColor(R, G, B, A)

       
    local worldAngleToTarget = (math.deg(atan2(dy, dx)) + 270) % 360

    local pilotViewAngle = (compass + look_x) % 360
 
    local relativeAzimuth = ((worldAngleToTarget - pilotViewAngle + 540) % 360) - 180

    local flatDist = math.sqrt(dx*dx + dy*dy)
    local relativeElevation = math.deg(math.atan(dz / flatDist)) - look_y

   
    if math.abs(relativeAzimuth) &lt;= 37 and math.abs(relativeElevation) &lt;= 30 then
        local screenX = HUD_CENTER_X + (relativeAzimuth/37)*128
        local screenY = HUD_CENTER_Y - (relativeElevation/30)*96

        screen.drawCircleF(screenX, screenY, 2)

        local distance = math.sqrt(dx*dx + dy*dy + dz*dz)
        local label = string.format("%.2f km", distance / 1000)
        screen.drawText(screenX + 3, screenY - 4, label)
    else
        --      
        local angle = atan2(relativeAzimuth, -relativeElevation)
        local r = 88

        local cx = HUD_CENTER_X + math.sin(angle) * r
        local cy = HUD_CENTER_Y + math.cos(angle) * r

        local size = 6
        screen.drawTriangleF(
            cx, cy,
            cx + math.sin(angle + 0.3) * size, cy + math.cos(angle + 0.3) * size,
            cx + math.sin(angle - 0.3) * size, cy + math.cos(angle - 0.3) * size
        )
    end
end


function drawLocator()
	screen.setColor(50, 0, 50, 200)
	screen.drawText(91, 11, "Locator~")
	if loc_dist == 0 then
		screen.drawText(132, 11, "[NULL]")
	elseif loc_dist == 0.25 then
		screen.drawText(132, 11, "(CLOSE)")
	else
		screen.drawText(132, 11, string.format("%.2f km", loc_dist))
	end
end

function drawUpperData()
	screen.setColor(0, 50, 20, 200)
	
	screen.drawText(0, 0, "CLU")
	screen.drawText(14, 0, ":")
	screen.drawText(18, 0, clutch &gt;= 0 and "+" or "-")
	screen.drawText(22, 0, string.format("%.2f", math.abs(clutch)))
	
	screen.drawText(0, 7, name_middle)
	screen.drawText(14, 7, ":")
	screen.drawText(18, 7, num_middle &gt;= 0 and "+" or "-")
	screen.drawText(22, 7, string.format("%.2f", math.abs(num_middle)))
	
	screen.drawText(0, 14, name_down)
	screen.drawText(14, 14, ":")
	screen.drawText(18, 14, num_down &gt;= 0 and "+" or "-")
	screen.drawText(22, 14, string.format("%.2f", math.abs(num_down)))
	
	screen.drawText(209, 0, "REV-")
	screen.drawText(228, 0, reverse == true and "ON" or "OFF")
	
	screen.drawText(209, 7, "RAD-")
	screen.drawText(228, 7, rad_switch == true and "ON" or "OFF")
	
	screen.drawText(209, 14, "LOC-")
	screen.drawText(228, 14, loc_switch == true and "ON" or "OFF")

end

function drawRadarDetected()
	screen.setColor(255, 0, 0, 200)
	if rdetect&gt;0 and blinker&gt;0 then
		screen.drawText(81, 187, "[DETECTED BY RADAR]")
	end
end

function onDraw()				
	screen.setColor(0, 0, 0)		
	screen.drawClear()  
	if nav_switch == true then
		drawNavArrows()
		drawTargetHUD(tgps_x, tgps_y, 0, 0, 0, 255, 200)
	end
	drawGPS()
	drawUpperData()
	drawCompass()
	drawRadarDetected()
	if loc_switch == true then
		drawLocator()
	end
end'>
					<pos x="3.75" y="-3.5"/>
					<in1 component_id="79"/>
				</object>
			</c>
			<c type="56">
				<object id="23" script="function onTick()
end

function drawRadar()
	
end

function onDraw()
end">
					<pos x="4.75" y="-4.5"/>
					<in1 component_id="32"/>
					<in2 component_id="20" node_index="1"/>
				</object>
			</c>
			<c type="40">
				<object id="26" count="7" offset="7">
					<pos x="1.75" y="-0.5"/>
					<inc component_id="39"/>
					<in1 component_id="48"/>
					<in2 component_id="49"/>
					<in3 component_id="67"/>
					<in4 component_id="68"/>
					<in5 component_id="70"/>
					<in6 component_id="73"/>
					<in7 component_id="86"/>
				</object>
			</c>
			<c type="40">
				<object id="32" count="6" offset="24">
					<pos x="2.75" y="-5.75"/>
					<inc component_id="41"/>
					<in1 component_id="75"/>
					<in2 component_id="76"/>
					<in3 component_id="68"/>
					<in4 component_id="78"/>
					<in5 component_id="48"/>
					<in6 component_id="49"/>
				</object>
			</c>
			<c type="31">
				<object id="48" i="8">
					<pos y="1"/>
					<in1 component_id="37"/>
				</object>
			</c>
			<c type="31">
				<object id="49" i="9">
					<pos y="0.75"/>
					<in1 component_id="37"/>
				</object>
			</c>
			<c type="58">
				<object id="71" n="custom_name_middle" v="THR">
					<pos x="-0.25" y="2"/>
				</object>
			</c>
			<c type="58">
				<object id="74" n="custom_name_down" v="CHA">
					<pos x="0.75" y="2"/>
				</object>
			</c>
			<c type="31">
				<object id="75" i="2">
					<pos x="1.25" y="-4.5"/>
					<in1 component_id="39"/>
				</object>
			</c>
			<c type="31">
				<object id="76" i="3">
					<pos x="1.25" y="-4.75"/>
					<in1 component_id="39"/>
				</object>
			</c>
			<c type="31">
				<object id="78" i="6">
					<pos x="1.25" y="-5.25"/>
					<in1 component_id="39"/>
				</object>
			</c>
			<c type="41">
				<object id="79" count="5">
					<pos x="2.75" y="-2.5"/>
					<inc component_id="26"/>
					<in1 component_id="87"/>
					<in2 component_id="88"/>
					<in3 component_id="90"/>
					<in4 component_id="47"/>
					<in5 component_id="64"/>
				</object>
			</c>
			<c type="56">
				<object id="83" script="last_ping_tick = 0
current_tick = 0
distance = 0

function onTick()
	locator = input.getBool(1)
	current_tick = current_tick + 1

	if locator then
		local dt = current_tick - last_ping_tick
		last_ping_tick = current_tick

		--  : d = (t - 5) / 0.02
		if dt &gt; 5 then
			local raw_distance = (dt - 5) / 0.02
			if raw_distance &lt;= 110000 then
				distance = raw_distance
			end
		end
	end

	--        
	if current_tick - last_ping_tick &gt; 2205 then
		distance = 0
	end

	output.setNumber(1, distance / 1000) --  
end">
					<pos x="-3.75" y="-0.75"/>
					<in1 component_id="85"/>
				</object>
			</c>
			<c type="41">
				<object id="85" count="1">
					<pos x="-5" y="-0.75"/>
					<in1 component_id="46"/>
				</object>
			</c>
			<c type="31">
				<object id="86">
					<pos x="-2.5" y="-0.5"/>
					<in1 component_id="83"/>
				</object>
			</c>
			<c type="29">
				<object id="87">
					<pos x="0.25" y="-1.5"/>
					<in1 component_id="43"/>
				</object>
			</c>
			<c type="29">
				<object id="88" i="1">
					<pos x="0.25" y="-1.75"/>
					<in1 component_id="43"/>
				</object>
			</c>
			<c type="29">
				<object id="90" i="2">
					<pos x="0.25" y="-2"/>
					<in1 component_id="43"/>
				</object>
			</c>
			<c type="57">
				<object id="91">
					<pos x="5.75" y="-7"/>
					<in1 component_id="23" node_index="1"/>
					<in2 component_id="94" node_index="1"/>
					<in3 component_id="92"/>
				</object>
			</c>
			<c>
				<object id="92">
					<pos x="4.75" y="-8"/>
					<in1 component_id="93"/>
				</object>
			</c>
			<c type="29">
				<object id="93" i="5">
					<pos x="-5.25" y="-8"/>
					<in1 component_id="37"/>
				</object>
			</c>
			<c type="56">
				<object id="94" script="function onTick()
	gps_x = input.getNumber(3)
	gps_y = input.getNumber(4)
	--also add other data about targets
end


function onDraw()	
	screen.drawMap(gps_x, gps_y, 50)	-- 50 (big map)
end">
					<pos x="3.75" y="-6.75"/>
					<in1 component_id="79"/>
				</object>
			</c>
		</components>
		<components_bridge>
			<c type="7">
				<object id="35">
					<pos x="8.25" y="-6.5"/>
					<in1 component_id="91"/>
				</object>
			</c>
			<c type="4">
				<object id="37">
					<pos x="-6.25" y="0.75"/>
				</object>
			</c>
			<c type="4">
				<object id="39">
					<pos x="-6.25" y="1.25"/>
				</object>
			</c>
			<c type="4">
				<object id="41">
					<pos x="-6.25" y="-4.25"/>
				</object>
			</c>
			<c type="4">
				<object id="43">
					<pos x="-6.25" y="-1.75"/>
				</object>
			</c>
			<c>
				<object id="46">
					<pos x="-6.25" y="-0.75"/>
				</object>
			</c>
			<c>
				<object id="47">
					<pos x="-6.25" y="-2.25"/>
				</object>
			</c>
			<c>
				<object id="64">
					<pos x="-6.25" y="-2.5"/>
				</object>
			</c>
			<c type="2">
				<object id="67">
					<pos y="0.5"/>
				</object>
			</c>
			<c type="2">
				<object id="68">
					<pos y="0.25"/>
				</object>
			</c>
			<c type="2">
				<object id="70"/>
			</c>
			<c type="2">
				<object id="73">
					<pos y="-0.25"/>
				</object>
			</c>
		</components_bridge>
		<groups/>
		<component_states>
			<c0 id="20" script='HUD_WIDTH = 257
HUD_HEIGHT = 192
HUD_CENTER_X = 126
HUD_CENTER_Y = 96
FOV_X = 74 
FOV_Y = 60 

blinker = 0
rdetect = 0

function to_degrees(from1to360)
	return from1to360*360
end

function atan2(y, x)
	if x &gt; 0 then
		return math.atan(y / x)
	elseif x &lt; 0 and y &gt;= 0 then
		return math.atan(y / x) + math.pi
	elseif x &lt; 0 and y &lt; 0 then
		return math.atan(y / x) - math.pi
	elseif x == 0 and y &gt; 0 then
		return math.pi / 2
	elseif x == 0 and y &lt; 0 then
		return -math.pi / 2
	else
		return 0
	end
end

function angleDelta(a, b)
	local d = (a - b) % 360
	if d &gt; 180 then d = d - 360 end
	return d
end

function onTick()
	distance	   = input.getNumber(1)
	relative_angle = input.getNumber(2)
	gps_x		  = input.getNumber(3)
	gps_y		  = input.getNumber(4)
	tgps_x		 = input.getNumber(5)
	tgps_y		 = input.getNumber(6)
	compass		= input.getNumber(7)
	look_x	 = to_degrees(input.getNumber(8))
	look_y	 = to_degrees(input.getNumber(9))
	clutch	 = input.getNumber(10)
	height	 = input.getNumber(11)
	num_middle = input.getNumber(12)
	num_down   = input.getNumber(13)
	loc_dist   = input.getNumber(14)
	
	nav_switch = input.getBool(1)
	rad_switch = input.getBool(2)
	loc_switch = input.getBool(3)
	rad_detect = input.getBool(4)
	reverse	= input.getBool(5)
	
	
	name_middle = property.getText("custom_name_middle")
	name_down   = property.getText("custom_name_down")
	
	
	view_angle = (compass + look_x) % 360
	
	blinker = blinker + 1
	if blinker &gt; 60 then
		blinker = -1*30
	end
	
	rdetect = math.max(0, rdetect-1)
	if rad_detect == true then
		rdetect = 600
	end
end




function drawCustomW(x, y)
	screen.drawLine(x,   y,   x,   y+4) 
	screen.drawLine(x+1, y+4, x+1, y+5)   
	screen.drawLine(x+2, y+3, x+2, y+4)   
	screen.drawLine(x+3, y+4, x+3, y+5)       
	screen.drawLine(x+4, y,   x+4, y+4) 
end

function drawCustomText(x, y, text)
	local cx = x
	for i = 1, #text do
		local char = text:sub(i, i)
		if char == "W" then
			drawCustomW(cx, y)
			cx = cx + 5 + 1 --   W + 
		else
			screen.drawText(cx, y, char)
			cx = cx + 4 + 1 --    + 
		end
	end
end

function getTextWidth(T)
	local w = 0
	for i = 1, #T do
		local c = T:sub(i, i)
		w = w + (c == "W" and 5 or 4)
		if i &lt; #T then
			w = w + 1
		end
	end
	return w
end

function drawCenteredCustomText(center_x, y, text)
	local total_width = getTextWidth(text)
	local start_x = math.floor(center_x - total_width / 2)
	drawCustomText(start_x, y, text)
end



function drawCompass()
	directions = {
{name="N", angle=0}, {name="|", angle=22.5}, {name="NE", angle=45},
{name="|", angle=67.5}, {name="E", angle=90}, {name="|", angle=112.5},
{name="SE", angle=135}, {name="|", angle=157.5}, {name="S", angle=180},
{name="|", angle=202.5}, {name="SW", angle=225}, {name="|", angle=247.5},
{name="W", angle=270}, {name="|", angle=292.5}, {name="NW", angle=315},
{name="|", angle=337.5}}
	panel_x, panel_y = 95, 0
	panel_w, panel_h = 61, 9 
	half_pw = 30

	screen.setColor(100, 100, 100)
	screen.drawRectF(panel_x-4,panel_y,panel_w+8,panel_h)
	screen.setColor(0, 10, 0)

	for _, dir in ipairs(directions) do
		local rel_angle = math.floor((dir.angle - view_angle + 540) % 360 - 180)
		if math.abs(rel_angle) &lt;= half_pw then     
			local x = HUD_CENTER_X + rel_angle - 3 
			if x &gt;= panel_x and x &lt;= panel_x + panel_w - 6 then
				local fade = math.abs(rel_angle) * 6
				local alpha = math.max(60, 255 - fade)
				screen.setColor(0, 50, 0, alpha)
				drawCenteredCustomText(math.floor(x)+3, 2, dir.name)
			end
		end
	end

    screen.setColor(0, 255, 0)
    screen.drawLine(HUD_CENTER_X, 0, HUD_CENTER_X, panel_h)
	
end

function drawGPS()
	screen.setColor(0, 255, 0)
	
	screen.drawText(0, 173, "H")
	screen.drawText(4, 173, ":")
	screen.drawText(8, 173, height &gt;= 0 and "+" or "-")
	screen.drawText(12, 173, math.abs(math.floor(height)))
	
	screen.drawText(0, 180, "X")
	screen.drawText(4, 180, ":")
	screen.drawText(8, 180, gps_x &gt;= 0 and "+" or "-")
	screen.drawText(12, 180, math.abs(math.floor(gps_x)))
	
	screen.drawText(0, 187, "Y")
	screen.drawText(4, 187, ":")
	screen.drawText(8, 187, gps_y &gt;= 0 and "+" or "-")
	screen.drawText(12, 187, math.abs(math.floor(gps_y)))
	
	screen.drawText(209, 173, "tD")
	screen.drawText(218, 173, ":")
	screen.drawText(222, 173, string.format("%.0fkm", distance))
	
	screen.drawText(209, 180, "tX")
	screen.drawText(218, 180, ":")
	screen.drawText(222, 180, tgps_x &gt;= 0 and "+" or "-")
	screen.drawText(226, 180, math.abs(math.floor(tgps_x)))
	
	screen.drawText(209, 187, "tY")
	screen.drawText(218, 187, ":")
	screen.drawText(222, 187, tgps_y &gt;= 0 and "+" or "-")
	screen.drawText(226, 187, math.abs(math.floor(tgps_y)))
end


function drawNavArrows()
	local relative_to_look = (relative_angle - look_x + 540) % 360 - 180
	screen.setColor(0, 0, 255, math.abs(relative_to_look))
	
	if blinker &gt; 0 then
	
		if relative_to_look &lt; -5 or relative_to_look &gt; 170 then
			screen.drawTriangleF(20, 90, 20, 110, 0, 100)
		end
		
		if relative_to_look &gt; 5 or relative_to_look &lt; -170 then
			screen.drawTriangleF(237, 90, 237, 110, 257, 100)
		end
		
	end
end


 

function drawTargetHUD(targetX, targetY, targetZ, R, G, B, A)
    local dx = targetX - gps_x
    local dy = targetY - gps_y
    local dz = targetZ - height
    screen.setColor(R, G, B, A)

       
    local worldAngleToTarget = (math.deg(atan2(dy, dx)) + 270) % 360

    local pilotViewAngle = (compass + look_x) % 360
 
    local relativeAzimuth = ((worldAngleToTarget - pilotViewAngle + 540) % 360) - 180

    local flatDist = math.sqrt(dx*dx + dy*dy)
    local relativeElevation = math.deg(math.atan(dz / flatDist)) - look_y

   
    if math.abs(relativeAzimuth) &lt;= 37 and math.abs(relativeElevation) &lt;= 30 then
        local screenX = HUD_CENTER_X + (relativeAzimuth/37)*128
        local screenY = HUD_CENTER_Y - (relativeElevation/30)*96

        screen.drawCircleF(screenX, screenY, 2)

        local distance = math.sqrt(dx*dx + dy*dy + dz*dz)
        local label = string.format("%.2f km", distance / 1000)
        screen.drawText(screenX + 3, screenY - 4, label)
    else
        --      
        local angle = atan2(relativeAzimuth, -relativeElevation)
        local r = 88

        local cx = HUD_CENTER_X + math.sin(angle) * r
        local cy = HUD_CENTER_Y + math.cos(angle) * r

        local size = 6
        screen.drawTriangleF(
            cx, cy,
            cx + math.sin(angle + 0.3) * size, cy + math.cos(angle + 0.3) * size,
            cx + math.sin(angle - 0.3) * size, cy + math.cos(angle - 0.3) * size
        )
    end
end


function drawLocator()
	screen.setColor(50, 0, 50, 200)
	screen.drawText(91, 11, "Locator~")
	if loc_dist == 0 then
		screen.drawText(132, 11, "[NULL]")
	elseif loc_dist == 0.25 then
		screen.drawText(132, 11, "(CLOSE)")
	else
		screen.drawText(132, 11, string.format("%.2f km", loc_dist))
	end
end

function drawUpperData()
	screen.setColor(0, 50, 20, 200)
	
	screen.drawText(0, 0, "CLU")
	screen.drawText(14, 0, ":")
	screen.drawText(18, 0, clutch &gt;= 0 and "+" or "-")
	screen.drawText(22, 0, string.format("%.2f", math.abs(clutch)))
	
	screen.drawText(0, 7, name_middle)
	screen.drawText(14, 7, ":")
	screen.drawText(18, 7, num_middle &gt;= 0 and "+" or "-")
	screen.drawText(22, 7, string.format("%.2f", math.abs(num_middle)))
	
	screen.drawText(0, 14, name_down)
	screen.drawText(14, 14, ":")
	screen.drawText(18, 14, num_down &gt;= 0 and "+" or "-")
	screen.drawText(22, 14, string.format("%.2f", math.abs(num_down)))
	
	screen.drawText(209, 0, "REV-")
	screen.drawText(228, 0, reverse == true and "ON" or "OFF")
	
	screen.drawText(209, 7, "RAD-")
	screen.drawText(228, 7, rad_switch == true and "ON" or "OFF")
	
	screen.drawText(209, 14, "LOC-")
	screen.drawText(228, 14, loc_switch == true and "ON" or "OFF")

end

function drawRadarDetected()
	screen.setColor(255, 0, 0, 200)
	if rdetect&gt;0 and blinker&gt;0 then
		screen.drawText(81, 187, "[DETECTED BY RADAR]")
	end
end

function onDraw()				
	screen.setColor(0, 0, 0)		
	screen.drawClear()  
	if nav_switch == true then
		drawNavArrows()
		drawTargetHUD(tgps_x, tgps_y, 0, 0, 0, 255, 200)
	end
	drawGPS()
	drawUpperData()
	drawCompass()
	drawRadarDetected()
	if loc_switch == true then
		drawLocator()
	end
end'>
				<pos x="3.75" y="-3.5"/>
				<in1 component_id="79"/>
			</c0>
			<c1 id="23" script="function onTick()
end

function drawRadar()
	
end

function onDraw()
end">
				<pos x="4.75" y="-4.5"/>
				<in1 component_id="32"/>
				<in2 component_id="20" node_index="1"/>
			</c1>
			<c2 id="26" count="7" offset="7">
				<pos x="1.75" y="-0.5"/>
				<inc component_id="39"/>
				<in1 component_id="48"/>
				<in2 component_id="49"/>
				<in3 component_id="67"/>
				<in4 component_id="68"/>
				<in5 component_id="70"/>
				<in6 component_id="73"/>
				<in7 component_id="86"/>
			</c2>
			<c3 id="32" count="6" offset="24">
				<pos x="2.75" y="-5.75"/>
				<inc component_id="41"/>
				<in1 component_id="75"/>
				<in2 component_id="76"/>
				<in3 component_id="68"/>
				<in4 component_id="78"/>
				<in5 component_id="48"/>
				<in6 component_id="49"/>
			</c3>
			<c4 id="48" i="8">
				<pos y="1"/>
				<in1 component_id="37"/>
			</c4>
			<c5 id="49" i="9">
				<pos y="0.75"/>
				<in1 component_id="37"/>
			</c5>
			<c6 id="71" n="custom_name_middle" v="THR">
				<pos x="-0.25" y="2"/>
			</c6>
			<c7 id="74" n="custom_name_down" v="CHA">
				<pos x="0.75" y="2"/>
			</c7>
			<c8 id="75" i="2">
				<pos x="1.25" y="-4.5"/>
				<in1 component_id="39"/>
			</c8>
			<c9 id="76" i="3">
				<pos x="1.25" y="-4.75"/>
				<in1 component_id="39"/>
			</c9>
			<c10 id="78" i="6">
				<pos x="1.25" y="-5.25"/>
				<in1 component_id="39"/>
			</c10>
			<c11 id="79" count="5">
				<pos x="2.75" y="-2.5"/>
				<inc component_id="26"/>
				<in1 component_id="87"/>
				<in2 component_id="88"/>
				<in3 component_id="90"/>
				<in4 component_id="47"/>
				<in5 component_id="64"/>
			</c11>
			<c12 id="83" script="last_ping_tick = 0
current_tick = 0
distance = 0

function onTick()
	locator = input.getBool(1)
	current_tick = current_tick + 1

	if locator then
		local dt = current_tick - last_ping_tick
		last_ping_tick = current_tick

		--  : d = (t - 5) / 0.02
		if dt &gt; 5 then
			local raw_distance = (dt - 5) / 0.02
			if raw_distance &lt;= 110000 then
				distance = raw_distance
			end
		end
	end

	--        
	if current_tick - last_ping_tick &gt; 2205 then
		distance = 0
	end

	output.setNumber(1, distance / 1000) --  
end">
				<pos x="-3.75" y="-0.75"/>
				<in1 component_id="85"/>
			</c12>
			<c13 id="85" count="1">
				<pos x="-5" y="-0.75"/>
				<in1 component_id="46"/>
			</c13>
			<c14 id="86">
				<pos x="-2.5" y="-0.5"/>
				<in1 component_id="83"/>
			</c14>
			<c15 id="87">
				<pos x="0.25" y="-1.5"/>
				<in1 component_id="43"/>
			</c15>
			<c16 id="88" i="1">
				<pos x="0.25" y="-1.75"/>
				<in1 component_id="43"/>
			</c16>
			<c17 id="90" i="2">
				<pos x="0.25" y="-2"/>
				<in1 component_id="43"/>
			</c17>
			<c18 id="91">
				<pos x="5.75" y="-7"/>
				<in1 component_id="23" node_index="1"/>
				<in2 component_id="94" node_index="1"/>
				<in3 component_id="92"/>
			</c18>
			<c19 id="92">
				<pos x="4.75" y="-8"/>
				<in1 component_id="93"/>
			</c19>
			<c20 id="93" i="5">
				<pos x="-5.25" y="-8"/>
				<in1 component_id="37"/>
			</c20>
			<c21 id="94" script="function onTick()
	gps_x = input.getNumber(3)
	gps_y = input.getNumber(4)
	--also add other data about targets
end


function onDraw()	
	screen.drawMap(gps_x, gps_y, 50)	-- 50 (big map)
end">
				<pos x="3.75" y="-6.75"/>
				<in1 component_id="79"/>
			</c21>
		</component_states>
		<component_bridge_states>
			<c0 id="35">
				<pos x="8.25" y="-6.5"/>
				<in1 component_id="91"/>
			</c0>
			<c1 id="37">
				<pos x="-6.25" y="0.75"/>
			</c1>
			<c2 id="39">
				<pos x="-6.25" y="1.25"/>
			</c2>
			<c3 id="41">
				<pos x="-6.25" y="-4.25"/>
			</c3>
			<c4 id="43">
				<pos x="-6.25" y="-1.75"/>
			</c4>
			<c5 id="46">
				<pos x="-6.25" y="-0.75"/>
			</c5>
			<c6 id="47">
				<pos x="-6.25" y="-2.25"/>
			</c6>
			<c7 id="64">
				<pos x="-6.25" y="-2.5"/>
			</c7>
			<c8 id="67">
				<pos y="0.5"/>
			</c8>
			<c9 id="68">
				<pos y="0.25"/>
			</c9>
			<c10 id="70"/>
			<c11 id="73">
				<pos y="-0.25"/>
			</c11>
		</component_bridge_states>
		<group_states/>
	</group>
</microprocessor>

